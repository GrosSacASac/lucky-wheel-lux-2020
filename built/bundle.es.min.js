function e(t){if((t||this)._callbacks=Object.create(null),t)return Object.assign(t,e.prototype)}e.prototype.on=function(e,t){(this._callbacks[e]=this._callbacks[e]||[]).push(t)},e.prototype.once=function(e,t){const o=n=>{this.off(e,o),t(n)};o.fn=t,this.on(e,o)},e.prototype.off=function(e,t){if(!e)return void(this._callbacks=Object.create(null));const o=this._callbacks[e];if(!o)return;if(!t)return void delete this._callbacks[e];const n=o.findIndex((function(e){return e===t||e.fn===t}));n>-1&&(1===o.length?delete this._callbacks[e]:o.splice(n,1))},e.prototype.emit=function(e,t){const o=this._callbacks[e];if(!o)return;Array.from(o).forEach((e=>{e(t)}))},e.prototype.listeners=function(e){return this._callbacks[e]||[]},e.prototype.hasListeners=function(e){return Boolean(this.listeners(e).length)},e.prototype.eventNames=function(){return Reflect.ownKeys(this._callbacks)},e.prototype.eventNamesStrings=function(){return Object.keys(this._callbacks)};const t=e=>{if("object"!=typeof e||null===e)return e;if(Array.isArray(e))return e.map(t);const o={};return Object.entries(e).forEach((([e,n])=>{o[e]=t(n)})),o},o=e=>{if("object"!=typeof e||null===e)return e;if(e instanceof Date)return new Date(e);if(e instanceof RegExp)return new RegExp(e);if(e instanceof Set)return new Set(Array.from(e,o));if(e instanceof Map){const t=new Map;return e.forEach(((e,n)=>{t.set(o(n),o(e))})),t}if(Array.isArray(e))return e.map(t);if(ArrayBuffer.isView(e)&&!(e instanceof DataView))return new e.constructor(e);const n={};return Object.entries(e).forEach((([e,o])=>{n[e]=t(o)})),n},n=Symbol(),r=Symbol(),a=e=>"object"==typeof e&&null!==e,s=(e,t,o)=>{Object.prototype.hasOwnProperty.call(e,t)?e[t].push(o):e[t]=[o]},{hasOwnProperty:i}=Object.prototype,c=e=>{e.remove()},l=(e,t)=>{t(e);let o=e.firstChild;for(;o;)1===o.nodeType?(l(o,t),o=o.nextElementSibling):o=o.nextSibling},u=e=>{const t=e.getAttribute("is");return t||e.tagName.toLowerCase()},m=e=>(e||console.error('Template missing <template data-template="d-name">\n                Template Content\n            </template>'),e.content||console.error("template.content is undefined, this can happen if a template is inside another template. Use only top level templates, also use recommended polyfills"),document.importNode(e.content,!0)),d=e=>e.join(">"),p=(e,t)=>0===e.length?t:`${d(e)}>${t}`,h=e=>e?`${e}>`:e,f=(e,t="")=>{Object.keys(e).forEach((o=>{o.startsWith(t)&&delete e[o]}))},g=(e,...t)=>{let o;return o=Array.isArray(e)?e.concat(t):[e,...t],d(o)},b=(e,t)=>{e.push(t)},y=e=>{e.pop()},E=(e,t,o)=>{t[e.propertyFromElement(t)]=o},v=(e,t,o,n,r,a)=>{i.call(e,"dom99_X")&&i.call(n,e.dom99_X)?r(e,t,o):S(e,o,a)},S=(e,t,o)=>{const n=document.createDocumentFragment();e.innerHTML="";const r=e.dom99_I,s=o.propertyFromElement(r.toUpperCase());t.forEach((e=>{const t=document.createElement(r);a(e)?Object.assign(t,e):t[s]=e,n.appendChild(t)})),e.appendChild(n)},_=e=>t=>Object.prototype.hasOwnProperty.call(e,t)?e[t]:e.MISS,A=_({INPUT:"value",TEXTAREA:"value",PROGRESS:"value",SELECT:"value",IMG:"src",SOURCE:"src",AUDIO:"src",VIDEO:"src",TRACK:"src",SCRIPT:"src",OPTION:"value",LINK:"href",DETAILS:"open",MISS:"textContent"}),I=_({checkbox:"checked",radio:"checked",MISS:"value"}),O=_({checkbox:"change",radio:"change",range:"change",file:"change",MISS:"input"}),$=_({SELECT:"change",TEXTAREA:"input",BUTTON:"click",FORM:"submit",MISS:"click"}),w={doneSymbol:"*",tokenSeparator:"-",listSeparator:" ",firstVariableValueStrategy:e=>e.value||(e=>void 0!==e.defaultValue?e.defaultValue:void 0!==e.open?e.open:e.textContent)(e),directives:{function:"data-function",variable:"data-variable",element:"data-element",list:"data-list",scope:"data-scope",template:"data-template",use:"data-use"},propertyFromElement:e=>{let t;return void 0!==e.tagName?({tagName:t}=e):t=e,"INPUT"===t?I(e.type):A(t)},eventNameFromElement:e=>{const{tagName:t}=e;return"INPUT"===t?O(e.type):$(t)},tagNamesForUserInput:["INPUT","TEXTAREA","SELECT","DETAILS"]},{start:T,elements:N,functions:P,variables:L,get:j,element:M,feed:D,plugin:k}=(e=>{const t={},o={},n={},r={},S={},_={};let A=[];const I=[];let O=!1;const $=[],w=[],T=(e,a,s)=>{const l=document.createDocumentFragment(),u=S[e.dom99_X],m=Array.from(A);A=a.split(">");const d=h(a),p=s.length;let g,b;if(i.call(e,"dom99_R")){if(g=e.dom99_R.length,g>p){for(let a=p;a<g;a+=1)b=`${d}${a}`,e.dom99_R[a].forEach(c),f(t,y=b),f(o,y),f(n,y),f(r,y);e.dom99_R.length=p}}else e.dom99_R=[],g=0;var y;s.forEach(((t,o)=>{if(b=`${d}${o}`,N(b,t),o<g)return;const n=j(u,String(o));e.dom99_R.push(Array.from(n.childNodes)),l.appendChild(n)})),A=m,e.appendChild(l)},N=(r,s)=>{if(void 0===s&&(s=r,r=""),a(r)&&console.error("Incorrect types passed to d.feed,\n                d.feed(string, object) or d.feed(object)"),O||(R(r,s),O=!0),a(s))if(Array.isArray(s))n[r]=s,i.call(o,r)&&((e,t,o,n,r,a)=>{e.forEach((e=>{v(e,t,o,n,r,a)}))})(o[r],r,s,S,T,e);else{const e=h(r),t=Object.entries(s);t.sort((([e,t],[o,n])=>Number(Array.isArray(n))-Number(Array.isArray(t)))),t.forEach((([t,o])=>{N(`${e}${t}`,o)}))}else n[r]=s,i.call(t,r)&&((e,t,o)=>{void 0!==o&&t.forEach((t=>{E(e,t,o)}))})(e,t[r],s);O=!1},P=(e,t,o)=>{_[o]||console.error(`Event listener ${o} not found.`),e.addEventListener(t,_[o],!1),A.length&&(e.dom99_C=d(A))};let L=P;const j=(e,t)=>{b(A,t);const o=m(e);return k(o),C(),y(A),o},M=[[e.directives.element,(t,o)=>{const n=o;n||console.error(t,`Use ${e.directives.element}="elementName" format!`);const a=p(A,n);r[a]=t}],[e.directives.template,(t,o)=>{if(o||console.error(t,`Use ${e.directives.template}="d-name" format!`),"TEMPLATE"!==t.tagName){const{innerHTML:e}=t;(t=document.createElement("template")).innerHTML=e}S[o]=t}],[e.directives.list,(t,r)=>{const[a,c,l]=r.split(e.tokenSeparator);if(a||console.error(t,`Use ${e.directives.list}="variableName-tagName" format!`),c){let e;l?(e=`${c}-${l}`,t.dom99_X=e):t.dom99_I=c;const o=t.tagName.toLowerCase();console.warn(`deprecated since 21.0.1\nReplace <${o} data-list="${a}-${e||c}"></${o}> with\n<${o} data-list="${a}" data-use="${e||c}"></${o}>`)}else{const o=t.getAttribute(e.directives.use);o.includes("-")?t.dom99_X=o:t.dom99_I=o}const u=p(A,a);if(s(o,u,t),t.childNodes.length>0){b(A,a);const e=Array.from(t.childNodes).filter((e=>1===e.nodeType)),o=d(A);void 0===n[o]&&(n[o]=Array.from({length:e.length},(()=>({})))),t.dom99_R=[],e.forEach(((e,o)=>{b(A,String(o)),k(e),t.dom99_R.push([e,...e.childNodes]),y(A)})),y(A)}i.call(n,u)&&v(t,u,n[u],S,T,e)}],[e.directives.variable,(o,r)=>{r||console.error(o,`Use ${e.directives.variable}="variableName" format!`);const a=p(A,r);s(t,a,o);let i=n[a];if(void 0===i&&void 0!==e.firstVariableValueStrategy&&(i=e.firstVariableValueStrategy(o)),void 0!==i&&(n[a]=i,E(e,o,i)),!e.tagNamesForUserInput.includes(o.tagName))return;o.addEventListener(e.eventNameFromElement(o),(()=>{const r=o[e.propertyFromElement(o)];n[a]=r,R(a,r),t[a].forEach((t=>{t!==o&&E(e,t,r)}))}),!1)}],[e.directives.function,(t,o)=>{o.split(e.listSeparator).forEach((o=>{const n=o.split(e.tokenSeparator);let r,a;1===n.length?(r=n[0],a=e.eventNameFromElement(t)):[a,r]=n,L(t,a,r)}))}],[e.directives.scope,(t,o)=>{o||console.error(t,`Use ${e.directives.scope}="insideWhat" format!`);const n=S[u(t)];if(n){const e=j(n,o);t.appendChild(e)}else t.setAttribute(e.directives.scope,`${e.doneSymbol}${o}`),b(A,o),k(t),y(A)}]],D=t=>{if(!t.hasAttribute)return;if(M.forEach((([o,n])=>{if(!t.hasAttribute(o))return;const r=t.getAttribute(o);r[0]!==e.doneSymbol&&(n(t,r),t.setAttribute(o,`${e.doneSymbol}${r}`))})),t.hasAttribute(e.directives.scope)||t.hasAttribute(e.directives.list))return;const o=u(t);i.call(S,o)&&t.appendChild(m(S[o]))},k=(e=document.body)=>(l(e,D),e),C=function(){const e=d(A);w.forEach((t=>{t(e)}))},R=(e,t)=>{$.forEach((o=>{o(e,t)}))};return{start:({startElement:e=document.body,initialFeed:t={},dataFunctions:o={}}={})=>{1!==e.nodeType&&console.error("start takes undefined or a node as first argument"),Object.assign(_,o),N("",t),k(e)},elements:r,functions:_,variables:n,get:(e,...t)=>n[g(e,...t)],element:(e,...t)=>r[g(e,...t)],feed:N,plugin:e=>{a(e)||console.error("plugin({\n                type,\n                plugin\n            });"),"function"===e.type?(I.push(e.plugin),L=(e,t,o)=>{let n=!1;const r=()=>{n=!0};I.forEach((n=>{n(e,t,o,_,r)})),n||P(e,t,o)}):"variable"===e.type?$.push(e.plugin):"cloned"===e.type?w.push(e.plugin):console.warn(`plugin type ${e.type} not yet implemented`)}}})(w);var C=Object.freeze({__proto__:null,start:function(e){e.on("WIN",(function(e){D("winLose","You WIN")})),e.on("LOSE",(function(e){D("winLose","You LOSE")})),e.on("MOVE",(function({distance:e,accuracy:t}){D("helpText",`Moved distance ${e} m  accuracy${t}`)})),e.on("DEBUG",(function(e){if(e.latitude){const{latitude:t,longitude:o}=e;D("debug",`DEBUG: latitude ${t} longitude ${o}`)}else e.code?D("debug",`DEBUG: code ${e.code} message ${e.message}`):D("debug",`DEBUG: ${e}`)}))}});const R=[[{backgroundColor:"grey"},{backgroundColor:"white"}],{duration:2e3,fill:"both"}],U=[[{transform:"rotate3d(0,0,0, 0)"},{transform:"rotate3d(0,1,0, 89.9deg)"}],{duration:4e3,fill:"both"}];var V=Object.freeze({__proto__:null,start:function(e){e.on("CHANGE_PLACE",(function(e){e.animate(...R)})),e.on("GO_INSIDE",(function(e){e.animate(...U)})),e.on("GO_OUTSIDE",(function(e){e.animate(U[0],{...U[1],direction:"reverse"})}))}});var G=Object.freeze({__proto__:null,start:function(e){Object.assign(P,{submit:function(t){const o=Number(j("chosenProposal"));e.emit("PRISON",o)}})}});var x=Object.freeze({__proto__:null,start:function(e){const t=[1,.95],o=new IntersectionObserver((o=>{o.forEach((o=>{o.intersectionRatio>=t[0]?e.emit("MOVE_VIRTUALLY",{element:o.target}):o.intersectionRatio<=t[1]&&e.emit("MOVE_VIRTUALLY",{element:void 0})}))}),{threshold:t});Array.from(document.getElementsByClassName("object")).forEach((e=>{o.observe(e)}))}});const F=e=>e*Math.PI/180;var J=Object.freeze({__proto__:null,start:function(e){let t,o=0;navigator.geolocation.watchPosition((function(n){const{latitude:r,longitude:a,accuracy:s}=n.coords;if(void 0!==t){const[n,i]=t;o+=function(e,t,o,n){const[r,a,s,i]=[e,t,o,n].map(F),c=Math.sin((r-s)/2)**2+Math.sin((a-i)/2)**2*Math.cos(r)*Math.cos(s);return 2*Math.atan2(c**.5,(1-c)**.5)*6378e3}(r,a,n,i),o>=5&&(e.emit("MOVE",{distance:o,accuracy:s}),o=0)}t=[r,a]}),(function(t){e.emit("DEBUG",t)}),{enableHighAccuracy:true,maximumAge:2e3})}});const B=[{tips:["There isn't a fruit without sugar","Every orange is a fruit"],answer:2,proposals:["There is no sugared plant that is not a fruit","All fruits containing sugar are oranges","Every orange contains sugar","No other response"]},{tips:["Tom: Jasmine eats more chocolate than David ","Jasmine: Tom eats half of the chocloate amount that David eats","Laura: Tom eats more chocalate than Jasmine","David: Laura eats less chocolate than Tom and Jasmine is the biggest chocolate eater"],answer:3,proposals:["Tom is lying","Jasmine is lying","David is lying","Laura is lying"]}],X=["1.JPG","2.JPG","3.JPG","4.JPG","5.JPG"].map((e=>`../images/${e}`));var H=Object.freeze({__proto__:null,start:function(e){const t=B[function(e=2){return Math.floor(Math.random()*e)}(B.length)];let o;D({tips:t.tips.map((e=>({text:e}))),proposals:t.proposals.map(((e,t)=>({textContent:e,value:String(t)})))});let n=!1,r=0;e.on("MOVE_VIRTUALLY",(function({element:t}){n||(t?(o=t,e.emit("CHANGE_PLACE",o),r+=1,document.body.style.setProperty("--background",`URL(${X[r%X.length]})`)):o=void 0)})),e.on("MOVE",(function(){if(o){const t=o.querySelector("img");n?(e.emit("GO_OUTSIDE",t),document.body.classList.remove("scroll-lock"),n=!1):(e.emit("GO_INSIDE",t),document.body.classList.add("scroll-lock"),n=!0)}}))}});const z=new class{constructor(){this.paused=!1,this.moduleInstances=new Map,this.boundModuleEmit=this.moduleEmit.bind(this),e(this)}getState(e){if(!this.moduleInstances.has(e))return Promise.reject(`module with name ${e} does not exist`);const t=this.moduleInstances.get(e);return t.module.getState?Promise.resolve().then((()=>t.module.getState(t.instance))):Promise.resolve({})}getAllStates(){const e=[],t=[];return this.moduleInstances.forEach(((o,n)=>{e.push(this.getState(n)),t.push(n)})),Promise.all(e).then((e=>{const o={};return e.forEach(((e,n)=>{o[t[n]]=e})),o}))}restoreState(e,t){if(!this.moduleInstances.has(e))return Promise.reject(`module with name ${e} does not exist`);const n=this.moduleInstances.get(e);return n.module.restoreState?Promise.resolve().then((()=>{const e=o(t);return n.module.restoreState(n.instance,e)})):Promise.resolve()}restoreAllStates(e){return Promise.all(Object.entries(e).map((([e,t])=>this.restoreState(e,t))))}start(t,{name:o=Symbol()}={}){if(this.moduleInstances.has(o))return Promise.reject(`module with name ${o} already started`);if(!t.start)return Promise.reject("module must have start defined");const n=new e;return n.emit=this.boundModuleEmit,Promise.resolve().then((()=>t.start(n))).then((e=>{this.moduleInstances.set(o,{module:t,instance:e,name:o,emitter:n})})).then((()=>o)).catch((e=>{this.emit(r,{time:Date.now(),phase:"module.start",error:e})}))}stop(e){const t=this.moduleInstances.get(e);return t?(t.emitter.off(),Promise.resolve().then((()=>{this.moduleInstances.delete(e),t.module.stop&&t.module.stop(t.instance)})).catch((e=>{this.emit(r,{time:Date.now(),phase:"module.stop",error:e})})).then((()=>!0))):Promise.resolve(!1)}moduleEmit(e,t){this.paused||this.moduleEmitDirect(e,t)}moduleEmitDirect(t,o){this.emit(t,o),this.emit(n,{name:t,data:o,time:Date.now()}),this.moduleInstances.forEach((({emitter:n})=>{try{e.prototype.emit.call(n,t,o)}catch(e){this.emit(r,{time:Date.now(),phase:"module runtime (emitter.on)",error:e})}}))}};((e,{logger:t=console}={})=>{e.on(n,(({name:e,data:o,time:n})=>{const r=new Date(n).toISOString();t.debug(`${r} event ${String(e)} with data`,o)})),e.on(r,(({time:e,phase:t,error:o})=>{const n=new Date(e).toISOString();console.error(`Error during phase ${t} at ${n}`,o)}))})(z),(async()=>{await z.start(C),await z.start(G),await z.start(J),await z.start(H),await z.start(V),T({initialFeed:{title:"Hello World",superParagraph:"Super Paragraph text"}}),await z.start(x)})();
